private void checkpoint(Asylum t) {
		try {
			db = new HandleDB();
			this.setCurrentRoom(t.getCurrentRoom());
			this.health=t.health;
			this.breathedGas=t.breathedGas;
			this.compassUsed=t.compassUsed;
			this.gasVuln=t.gasVuln;
			this.maxMoves=t.maxMoves;
			db.updateTuple(player, this);
			db.closeConnection();
			System.out.println("Saved game!");
		} catch (Exception e) {
			System.out.println(e.getMessage());
		}
	}
	
private void changeRoom(CommandType c, PrintStream out) {
		if(compassUsed || c==CommandType.UP || c==CommandType.DOWN) {
			try {
				Room next = searchDirection(commandToDirection(c));
				if (next == null) {
					out.println("There is no adjacent room in that direction!");
				} else if(getMap().readArc(getCurrentRoom(), next).isLocked()) {
					out.println("The door appears to be locked ...");
				} else {
					setCurrentRoom(next);
					setCurrentEnemy(null);
					for(AdventureCharacter a: getCurrentRoom().getEnemies()) {
						if(a instanceof Enemy && a.getHealth()>0) {
							setCurrentEnemy((Enemy)a);
							break;
						}
					}
					//trap management
					if(getCurrentRoom().hasTrap()) {
						getCurrentRoom().getTrap().accept(this);
					}
					out.println(getCurrentRoom().getDescription());
				}
			} catch (Exception e) {
				out.println(e.getMessage());
			}
		}else {
			out.println("If only I had a compass ...");
		}
	}
	
@Override
	public void nextMove(ParserOutput p, PrintStream out) {
		// TODO Auto-generated method stub

		if (p.getObject()==null && p.getEnemy()==null && p.getTarget()==null) {
			switch (p.getCommand().getType()) {
			case INVENTORY:
				for(Item i : getInventory().getList()) {
					out.println(i.getName());
				}
				if(getInventory().getList().isEmpty())
					out.println("Empty inventory!");
				break;
			case LOOK_AT:
				out.println(getCurrentRoom().getLook());
				if(!getCurrentRoom().getObjects().isEmpty()) {
					if(getCurrentRoom().hasLight()) {
						out.println("The room also contains: ");
						for(Item i : getCurrentRoom().getObjects()) {
							out.println(i.getName());
						}
					}
				}
				break;
			case NORD:
				changeRoom(p.getCommand().getType(), out);
				break;
			case NORTH_EAST:
				changeRoom(p.getCommand().getType(), out);
				break;
			case NORTH_WEST:
				changeRoom(p.getCommand().getType(), out);
				break;
			case SOUTH_EAST:
				changeRoom(p.getCommand().getType(), out);
				break;
			case SOUTH_WEST:
				changeRoom(p.getCommand().getType(), out);
				break;
			case EAST:
				changeRoom(p.getCommand().getType(), out);
				break;
			case WEST:
				changeRoom(p.getCommand().getType(), out);
				break;
			case SOUTH:
				changeRoom(p.getCommand().getType(), out);
				break;
			case UP:
				changeRoom(p.getCommand().getType(), out);
				break;
			case DOWN:
				changeRoom(p.getCommand().getType(), out);
				break;
			case WALK_TO:
				outer:
				try {
					for(Room a : getMap().getAdjacents(getCurrentRoom())) {
						if(a.getName().equals(p.getNextRoom())) {
							 if(getMap().readArc(getCurrentRoom(), a).isLocked()) {
								out.println("The door appears to be locked ...");
								break outer;
							} else {
							setCurrentRoom(a);
							setCurrentEnemy(null);
							for(AdventureCharacter ad: getCurrentRoom().getEnemies()) {
								if(ad instanceof Enemy && ad.getHealth()>0) {
									setCurrentEnemy((Enemy)ad);
									break;
								}
							}
							//gestione trappola
							if(getCurrentRoom().hasTrap()) {
								getCurrentRoom().getTrap().accept(this);
							}
							if(this.health>0) {
								out.println(getCurrentRoom().getDescription());
							}
							break;
						}
					}
					}
					if(!getCurrentRoom().getName().equals(p.getNextRoom())) {
						out.println("There is no adjacent room with this name!");
					}

				}catch (Exception e) {
					// TODO: handle exception
				}
				break;
			default:
				out.println(ResourceBundle.getBundle("InvalidCommandException", lang).getString("standard"));

			}
		} else if(p.getObject()!=null && p.getTarget()==null) {
			p.getObject().getHandler().apply(p.getCommand().getType()).accept(this);
		} else if(p.getEnemy()!=null && p.getTarget()==null) {
			switch (p.getCommand().getType()) {
			case TALK_TO:
				if (p.getEnemy().getHealth()>0 && p.getEnemy() instanceof Enemy) {
				out.println(p.getEnemy().getTalk());
				}
				else {
					out.println("The enemy is now dead, you can talk to him calmly in the cemetery ...");
				}
				break;
			case BREAK:
				if(p.getEnemy().getHealth()>0 && p.getEnemy() instanceof Enemy) {
					setCurrentEnemy((Enemy)p.getEnemy());
					p.getEnemy().setHealth(p.getEnemy().getHealth()-5);
				}else {
					out.println("You shouldn't ... It doesn't seem to be threatening!");
				}
				break;
			case LOOK_AT:
				out.println(p.getEnemy().getDescription());
				if(p.getEnemy().getHealth() <= 0) {
					for(Item i: p.getEnemy().getInv().getList()) {
						getCurrentRoom().getObjects().add(i);
					}
					p.getEnemy().getInv().getList().clear();
				}
				break;
			default:
				out.println(ResourceBundle.getBundle("InvalidCommandException", lang).getString("standard"));
				break;
			}
		} else if(p.getObject()!=null && p.getTarget()!=null) {
			switch (p.getCommand().getType()) {
			case DROP:
				if(p.getTarget() instanceof ItemContainer) {
					p.getObject().getHandler().apply(CommandType.DROP);
					getCurrentRoom().getObjects().remove(p.getObject());
					((ItemContainer) p.getTarget()).add(p.getObject());
				}else {
					out.println(ResourceBundle.getBundle("InvalidCommandException", lang).getString("standard"));
				}
				break;
			case BREAK:
				if(p.getTarget() instanceof Weapon) {
					p.getObject().getHandler().apply(CommandType.BREAK);
					Integer s = ((Weapon) p.getTarget()).getShots();
					((Weapon) p.getTarget()).setShots(s-1);
				}else {
					out.println(ResourceBundle.getBundle("InvalidCommandException", lang).getString("standard"));
				}
				break;
			default:
				out.println(ResourceBundle.getBundle("InvalidCommandException", lang).getString("standard"));
				break;
			}
		}

		//gestione del gas
		if(this.breathedGas) {
			switch(maxMoves) {
				case 4:
					out.println("The gas begins to enter the body.");
					break;
				case 3:
					out.println("The gas is starting to take effect, symptoms of soreness and weakness.");
					break;
				case 2:
					out.println("The gas is starting to cloud your ideas and you can't think anymore, you have to hurry.");
					break;
				case 1:
					out.println("The view becomes blurred, your end is near.");
					break;
				case 0:
					out.println("You died of asphyxiation.");
					System.exit(0);
					break;
				}
				maxMoves--;
			}

		if(getCurrentEnemy()!=null && getCurrentEnemy().getHealth()>0 && getCurrentRoom().hasLight()) {
			health = health - getCurrentEnemy().getDamage();
			if(health<0) health=0;
			out.println(getCurrentEnemy().getName()+" attacked you! Health: "+ health);
			out.println(getCurrentEnemy().getName()+" has health: "+getCurrentEnemy().getHealth());
		}
		if(getCurrentEnemy()!=null && getCurrentEnemy().getHealth()<=0) {
			out.println("You've killed "+getCurrentEnemy().getName()+"!");
			if(getCurrentEnemy().getDroppable()!=null) {
				getCurrentRoom().getObjects().add(getCurrentEnemy().getDroppable());
				out.println(getCurrentEnemy().getName()+" released "+getCurrentEnemy().getDroppable().getName());
				getCurrentEnemy().setDroppable(null);
			}
			setCurrentEnemy(null);
		}

		if(health==0) {
			out.println("You are dead! GAME OVER!");
			Thread.currentThread().interrupt();
			return;
		}

	}